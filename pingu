#!/bin/sh

trap : INT TERM QUIT

command=$*
eval "$@"
status=$?

if [ ${status} -eq 0 ]; then
    color="good"
    emoji=":white_check_mark:"
else
    color="danger"
    emoji=":x:"
fi
text="${emoji} \`${command}\`"
fallback="${emoji} ${command}"

echo '{
    "username": "pingu",
    "icon_emoji": ":penguin:",
    "attachments": [
         {
            "text": "'"${text}"'",
            "fallback": "'"${fallback}"'",
            "color": "'"${color}"'",
            "footer": "'"$(hostname)"'"
        }
    ]
}' | curl -sSLd @- "${SLACK_WEBHOOK_URL}" > /dev/null

exit ${status}
