#!/usr/bin/env bash

source ~/.pingurc

start=$(date +%s)
command=$*
"$@"
status=$?
diff=$(echo "$(date +%s) - ${start}" | bc)
text="Finished in ${diff} seconds."
if [ "${status}" -eq 0 ]; then
    color=good
    text="${text} All good! :ok_hand:"
else
    color=danger
    text="${text} Exited with code ${status}... :thinking_face:"
fi

echo " 
{
    'username': 'pingu', 
    'channel': '${channel}',
    'icon_emoji': ':penguin:',
    'attachments': [
        {
            'fallback': '${text}',
            'text': '${text}',
            'color': '${color}',
            'footer': '$(hostname)',
            'ts': '${start}',
            'fields': [
                {
                    'title': 'Command',
                    'value': '\`${command}\`',
                    'short': false
                }
            ]
        }
    ]
}
" | tr "'" '"' | curl -Ld @- "${webhook}"
