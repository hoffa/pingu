#!/usr/bin/env bash

trap : INT TERM QUIT

source ~/.pingurc

# want to see whole message in noti if possible...
# don't care that much what the actual code was 
# just show success/failure emoji!

start=$(date +%s)
command=$*
"$@"
if [ $? -eq 0 ]; then
    color="good"
    text=":white_check_mark:"
else
    color="danger"
    text=":x:"
fi

echo " 
{
    'username': 'pingu', 
    'icon_emoji': ':penguin:',
    'attachments': [
        {
            'fallback': '${text} ${command}',
            'text': '${text} \`${command}\`',
            'color': '${color}',
            'footer': '$(hostname)',
            'ts': '${start}'
        }
    ]
}
" | tr "'" '"' | curl -sSLd @- "${webhook}" > /dev/null

exit ${status}
